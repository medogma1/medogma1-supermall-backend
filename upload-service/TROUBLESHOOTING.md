# دليل استكشاف الأخطاء وإصلاحها

هذا الدليل يساعدك في حل المشاكل الشائعة التي قد تواجهها مع خدمة الرفع.

## مشاكل مجلد node_modules

### المشكلة: خطأ في تحميل الوحدات أو مكتبات مفقودة

**الأعراض:**
- رسائل خطأ مثل `Cannot find module 'express'`
- رسائل خطأ مثل `Error: Cannot find module '../lib/utils/common'`
- تعطل الخدمة عند بدء التشغيل

**الحلول:**

1. **إعادة تثبيت التبعيات:**
   ```bash
   # استخدم ملف إعادة التثبيت المتوفر
   ./reinstall-dependencies.bat
   ```

2. **حذف مجلد node_modules يدويًا وإعادة التثبيت:**
   ```bash
   # حذف مجلد node_modules
   rmdir /s /q node_modules
   # حذف ملف package-lock.json
   del package-lock.json
   # إعادة تثبيت التبعيات
   npm install
   ```

3. **تنظيف ذاكرة التخزين المؤقت لـ npm:**
   ```bash
   npm cache clean --force
   npm install
   ```

## مشاكل التكوين

### المشكلة: خطأ في تحميل ملف .env

**الأعراض:**
- رسائل خطأ تتعلق بـ `process.env`
- استخدام القيم الافتراضية بدلاً من القيم المخصصة

**الحلول:**

1. **التأكد من وجود ملف .env:**
   تأكد من وجود ملف `.env` في مجلد الخدمة ويحتوي على الإعدادات الصحيحة.

2. **إنشاء ملف .env جديد:**
   ```
   PORT=5009
   UPLOAD_DIR=uploads
   MAX_FILE_SIZE=5242880
   ALLOWED_FILE_TYPES=jpeg,png,gif,svg+xml
   ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8080
   ```

## مشاكل الاتصال

### المشكلة: تعذر الاتصال بالخدمة

**الأعراض:**
- رسائل خطأ مثل `Connection refused`
- عدم القدرة على الوصول إلى `http://localhost:5009`

**الحلول:**

1. **التأكد من تشغيل الخدمة:**
   استخدم ملف `start-service.bat` لتشغيل الخدمة.

2. **التحقق من المنفذ:**
   تأكد من أن المنفذ 5009 غير مستخدم من قبل تطبيق آخر.
   ```bash
   # للتحقق من المنفذ المستخدم
   netstat -ano | findstr :5009
   ```

3. **تغيير المنفذ:**
   إذا كان المنفذ 5009 مستخدمًا، قم بتغيير المنفذ في ملف `.env`:
   ```
   PORT=5010
   ```

## مشاكل رفع الملفات

### المشكلة: فشل في رفع الملفات

**الأعراض:**
- رسائل خطأ مثل `File too large`
- رسائل خطأ مثل `Invalid file type`

**الحلول:**

1. **التحقق من حجم الملف:**
   تأكد من أن حجم الملف أقل من الحد الأقصى المحدد في ملف `.env` (الافتراضي: 5MB).

2. **التحقق من نوع الملف:**
   تأكد من أن نوع الملف مسموح به في ملف `.env` (الافتراضي: jpeg, png, gif, svg+xml).

3. **التحقق من مجلد التحميل:**
   تأكد من وجود مجلد `uploads` وأن لديه أذونات الكتابة المناسبة.

## استخدام أدوات التشخيص

تم توفير عدة أدوات لمساعدتك في تشخيص المشاكل وحلها:

1. **تشخيص الخدمة:**
   ```bash
   ./diagnose.bat
   ```
   يقوم بفحص التكوين والتبعيات ومجلدات التحميل.

2. **اختبار الخدمة:**
   ```bash
   ./test-service.bat
   ```
   يقوم باختبار نقاط النهاية المختلفة ووظيفة رفع الملفات.

3. **إعادة تثبيت التبعيات:**
   ```bash
   ./reinstall-dependencies.bat
   ```
   يقوم بإعادة تثبيت جميع التبعيات من الصفر.

## الحصول على المساعدة

إذا استمرت المشاكل بعد محاولة الحلول المذكورة أعلاه، يرجى:

1. التحقق من سجلات الخدمة للحصول على مزيد من المعلومات حول الخطأ.
2. التأكد من تثبيت إصدار Node.js المناسب (الإصدار 14 أو أحدث).
3. التحقق من توافق إصدارات التبعيات في ملف `package.json`.