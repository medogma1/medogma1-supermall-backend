# الهيكل المعماري لمشروع Super Mall Backend

يوثق هذا المستند الهيكل المعماري لمشروع Super Mall Backend، ويشرح كيفية تنظيم الخدمات المصغرة (Microservices) والتفاعل بينها.

## نظرة عامة على الهيكل

يتبع المشروع نمط الهيكل المعماري للخدمات المصغرة (Microservices Architecture)، حيث يتم تقسيم التطبيق إلى خدمات مستقلة تتواصل فيما بينها عبر واجهات برمجة التطبيقات (APIs).

![هيكل الخدمات المصغرة](https://example.com/microservices-architecture.png)

## المكونات الرئيسية

### 1. بوابة API (API Gateway)

**الوصف**: نقطة دخول موحدة لجميع طلبات العملاء، تقوم بتوجيه الطلبات إلى الخدمات المناسبة.

**المسؤوليات**:
- توجيه الطلبات
- التحقق من المصادقة
- تحويل البروتوكولات
- موازنة الحمل

**التقنيات**: Express.js

**المنفذ**: 5001

### 2. خدمة المصادقة (Auth Service)

**الوصف**: تدير عمليات المصادقة وإدارة المستخدمين.

**المسؤوليات**:
- تسجيل المستخدمين
- تسجيل الدخول
- إدارة الجلسات
- التحقق من الهوية

**التقنيات**: Express.js, JWT, bcrypt

**المنفذ**: 5000

### 3. خدمة المستخدمين (User Service)

**الوصف**: تدير معلومات المستخدمين وملفاتهم الشخصية.

**المسؤوليات**:
- إدارة الملفات الشخصية
- إدارة العناوين
- إدارة تفضيلات المستخدمين

**التقنيات**: Express.js, MySQL

**المنفذ**: 5002

### 4. خدمة المنتجات (Product Service)

**الوصف**: تدير قائمة المنتجات والفئات والتقييمات.

**المسؤوليات**:
- إدارة المنتجات
- إدارة الفئات
- إدارة التقييمات والمراجعات
- البحث عن المنتجات

**التقنيات**: Express.js, MySQL

**المنفذ**: 5003

### 5. خدمة الطلبات (Order Service)

**الوصف**: تدير عمليات الطلب والدفع والشحن.

**المسؤوليات**:
- إدارة سلة التسوق
- معالجة الطلبات
- تتبع حالة الطلب
- إدارة المدفوعات

**التقنيات**: Express.js, MySQL

**المنفذ**: 5004

### 6. خدمة البائعين (Vendor Service)

**الوصف**: تدير معلومات البائعين ومنتجاتهم.

**المسؤوليات**:
- إدارة حسابات البائعين
- إدارة منتجات البائعين
- إدارة المبيعات والعمولات

**التقنيات**: Express.js, MySQL

**المنفذ**: 5005

### 7. خدمة التحليلات (Analytics Service)

**الوصف**: تجمع وتحلل بيانات استخدام النظام.

**المسؤوليات**:
- تحليل سلوك المستخدم
- تتبع المبيعات
- تحليل أداء المنتجات
- تقارير الأداء

**التقنيات**: Express.js, MySQL

**المنفذ**: 5006

### 8. خدمة الإشعارات (Notification Service)

**الوصف**: تدير إرسال الإشعارات للمستخدمين.

**المسؤوليات**:
- إرسال إشعارات البريد الإلكتروني
- إرسال الإشعارات داخل التطبيق
- إدارة تفضيلات الإشعارات

**التقنيات**: Express.js, MySQL, Nodemailer

**المنفذ**: 5007

### 9. خدمة الدعم (Support Service)

**الوصف**: تدير طلبات الدعم والأسئلة الشائعة.

**المسؤوليات**:
- إدارة تذاكر الدعم
- إدارة الأسئلة الشائعة
- التواصل مع العملاء

**التقنيات**: Express.js, MySQL

**المنفذ**: 5008

### 10. خدمة الدردشة (Chat Service)

**الوصف**: تدير المحادثات بين المستخدمين والبائعين.

**المسؤوليات**:
- إدارة المحادثات
- إرسال واستقبال الرسائل
- تخزين سجل المحادثات

**التقنيات**: Express.js, MySQL, Socket.io

**المنفذ**: 5009

### 11. خدمة الرفع (Upload Service)

**الوصف**: تدير عمليات رفع وتخزين الملفات.

**المسؤوليات**:
- رفع الصور
- معالجة الملفات
- تخزين الملفات

**التقنيات**: Express.js, Multer

**المنفذ**: 5010

## المكتبات المشتركة

### 1. مكتبة المصادقة (Auth Library)

**المسار**: `utils/auth/`

**المكونات**:
- `authMiddleware.js`: وسيط للتحقق من المصادقة
- `tokenUtils.js`: أدوات إدارة التوكنات

### 2. المكتبات المشتركة العامة (Common Libraries)

**المسار**: `utils/common/`

**المكونات**:
- `responseHandler.js`: معالج موحد للاستجابات
- `errorHandler.js`: معالج موحد للأخطاء

### 3. نماذج البيانات المشتركة (Shared Models)

**المسار**: `utils/models/`

**المكونات**:
- `BaseModel.js`: نموذج أساسي لجميع النماذج

### 4. السكربتات المشتركة (Shared Scripts)

**المسار**: `utils/scripts/`

**المكونات**:
- `diagnose.bat`: أداة تشخيص للخدمات
- `reinstall-dependencies.bat`: أداة إعادة تثبيت التبعيات

## نمط التواصل

### 1. التواصل المتزامن (Synchronous Communication)

- **REST API**: تستخدم الخدمات واجهات برمجة تطبيقات RESTful للتواصل فيما بينها.
- **بوابة API**: تعمل كوسيط بين العملاء والخدمات الداخلية.

### 2. التواصل غير المتزامن (Asynchronous Communication)

- **WebSockets**: تستخدم في خدمة الدردشة للتواصل في الوقت الحقيقي.

## إدارة البيانات

### 1. قاعدة البيانات

- **نوع قاعدة البيانات**: MySQL
- **نمط**: قاعدة بيانات لكل خدمة (Database per Service)

### 2. نماذج البيانات

- تستخدم كل خدمة نماذج بيانات خاصة بها
- تستخدم جميع النماذج `BaseModel.js` كأساس

## تدفق البيانات

### 1. تسجيل المستخدم

1. يرسل العميل طلب تسجيل إلى بوابة API
2. توجه بوابة API الطلب إلى خدمة المصادقة
3. تتحقق خدمة المصادقة من البيانات وتنشئ حساب مستخدم جديد
4. ترسل خدمة المصادقة طلبًا إلى خدمة المستخدمين لإنشاء ملف شخصي
5. ترسل خدمة المصادقة طلبًا إلى خدمة الإشعارات لإرسال بريد إلكتروني ترحيبي
6. ترجع بوابة API استجابة إلى العميل

### 2. شراء منتج

1. يرسل العميل طلب إضافة منتج إلى سلة التسوق
2. توجه بوابة API الطلب إلى خدمة الطلبات
3. تتحقق خدمة الطلبات من توفر المنتج عبر خدمة المنتجات
4. تضيف خدمة الطلبات المنتج إلى سلة التسوق
5. عند إتمام الطلب، تتواصل خدمة الطلبات مع خدمة المدفوعات
6. بعد نجاح الدفع، تحدث خدمة الطلبات حالة الطلب
7. ترسل خدمة الطلبات طلبًا إلى خدمة الإشعارات لإرسال تأكيد الطلب
8. ترسل خدمة الطلبات طلبًا إلى خدمة التحليلات لتسجيل المبيعات
9. ترجع بوابة API استجابة إلى العميل

## تشغيل الخدمات

### 1. تشغيل جميع الخدمات

```bash
npm run start:all
```

### 2. تشغيل الخدمات الأساسية

```bash
npm run start:core
```

### 3. تشغيل خدمات محددة

```bash
npm run start:services service1 service2
```

## تحسينات مستقبلية

### 1. تحسينات البنية التحتية

- تطبيق Docker لتوحيد بيئة التطوير والإنتاج
- إضافة Kubernetes لإدارة النشر والتوسع
- تطبيق Service Mesh لتحسين التواصل بين الخدمات

### 2. تحسينات الأداء

- إضافة Redis للتخزين المؤقت
- تطبيق نمط CQRS لفصل عمليات القراءة والكتابة
- تحسين أداء قواعد البيانات

### 3. تحسينات المرونة

- تطبيق نمط Circuit Breaker لتحسين المرونة
- إضافة آليات التعافي التلقائي
- تحسين آليات المراقبة والتنبيه

## الخلاصة

يوفر الهيكل المعماري للخدمات المصغرة في مشروع Super Mall Backend مرونة وقابلية للتوسع، مما يسمح بتطوير وصيانة كل خدمة بشكل مستقل. يعتمد المشروع على تقنيات حديثة ويتبع أفضل الممارسات في تصميم وتطوير الخدمات المصغرة.