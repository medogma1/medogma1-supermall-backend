/**
 * وسيط للتحقق من أدوار المستخدمين
 * يستخدم للتأكد من أن المستخدم لديه الصلاحيات المناسبة للوصول إلى مسارات معينة
 */

module.exports = (...roles) => {
  return (req, res, next) => {
    // التحقق من وجود معلومات المستخدم (يجب أن يكون قد مر عبر وسيط المصادقة أولاً)
    if (!req.user) {
      return res.status(401).json({ message: 'غير مصرح - يرجى تسجيل الدخول أولاً' });
    }

    // التحقق من أن دور المستخدم موجود في قائمة الأدوار المسموح بها
    if (!roles.includes(req.user.role)) {
      return res.status(403).json({ 
        message: 'غير مسموح - ليس لديك الصلاحيات الكافية للوصول إلى هذا المورد',
        requiredRoles: roles,
        yourRole: req.user.role
      });
    }

    // السماح بالمتابعة إذا كان الدور مسموحًا به
    next();
  };
};