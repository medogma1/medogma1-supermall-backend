# توثيق شامل لنظام SuperMall Backend

## نظرة عامة

نظام SuperMall Backend هو نظام خلفي متكامل لمنصة التجارة الإلكترونية، مبني على بنية الخدمات المصغرة (Microservices Architecture) باستخدام Node.js و MySQL. يوفر النظام جميع الوظائف اللازمة لإدارة متجر إلكتروني شامل.

## البنية التقنية

### التقنيات المستخدمة
- **اللغة**: Node.js (JavaScript)
- **قاعدة البيانات**: MySQL 8.0+
- **إطار العمل**: Express.js
- **المصادقة**: JWT (JSON Web Tokens)
- **التوثيق**: Swagger/OpenAPI
- **الحاويات**: Docker
- **إدارة العمليات**: PM2

### بنية الخدمات المصغرة

يتكون النظام من 11 خدمة مصغرة مستقلة:

```
supermall-backend/
├── api-gateway/         # بوابة API الرئيسية (المنفذ 5001)
├── auth-service/        # خدمة المصادقة والمستخدمين (المنفذ 5000)
├── user-service/        # خدمة إدارة المستخدمين (المنفذ 5002)
├── product-service/     # خدمة إدارة المنتجات (المنفذ 5003)
├── order-service/       # خدمة إدارة الطلبات (المنفذ 5004)
├── vendor-service/      # خدمة إدارة البائعين (المنفذ 5005)
├── support-service/     # خدمة الدعم الفني (المنفذ 5006)
├── chat-service/        # خدمة الدردشة (المنفذ 5007)
├── notification-service/# خدمة الإشعارات (المنفذ 5008)
├── upload-service/      # خدمة رفع الملفات (المنفذ 5009)
└── analytics-service/   # خدمة التحليلات (المنفذ 5010)
```

## الخدمات المصغرة - التوثيق التفصيلي

### 1. بوابة API (API Gateway) - المنفذ 5001

**الوصف**: نقطة الدخول الرئيسية لجميع طلبات API، تقوم بتوجيه الطلبات إلى الخدمات المناسبة.

**الوظائف الرئيسية**:
- توجيه الطلبات (Request Routing)
- إدارة CORS
- تسجيل الطلبات (Request Logging)
- معالجة الأخطاء المركزية
- إدارة معدل الطلبات (Rate Limiting)

**المسارات الرئيسية**:
```
/auth/*          → auth-service (5000)
/users/*         → user-service (5002)
/products/*      → product-service (5003)
/orders/*        → order-service (5004)
/vendors/*       → vendor-service (5005)
/support/*       → support-service (5006)
/chat/*          → chat-service (5007)
/notifications/* → notification-service (5008)
/upload/*        → upload-service (5009)
/analytics/*     → analytics-service (5010)
```

### 2. خدمة المصادقة (Auth Service) - المنفذ 5000

**الوصف**: تدير جميع عمليات المصادقة والتفويض في النظام.

**الوظائف الرئيسية**:
- تسجيل المستخدمين الجدد
- تسجيل الدخول والخروج
- إدارة الجلسات
- إنشاء وتحقق من JWT tokens
- إدارة الأدوار والصلاحيات
- استعادة كلمة المرور
- إدارة الملفات الشخصية

**المسارات (Routes)**:
```
POST /auth/register     # تسجيل مستخدم جديد
POST /auth/login        # تسجيل الدخول
POST /auth/logout       # تسجيل الخروج
GET  /auth/profile      # الحصول على الملف الشخصي
PUT  /auth/profile      # تحديث الملف الشخصي
POST /auth/forgot       # نسيان كلمة المرور
POST /auth/reset        # إعادة تعيين كلمة المرور
GET  /auth/verify       # التحقق من الرمز المميز
```

**حساب المسؤول الافتراضي**:
- البريد الإلكتروني: `admin@supermall.com`
- كلمة المرور: `xx100100`
- الدور: `admin`

### 3. خدمة المنتجات (Product Service) - المنفذ 5003

**الوصف**: تدير جميع عمليات المنتجات والفئات والمخزون.

**الوظائف الرئيسية**:
- إدارة المنتجات (إضافة، تعديل، حذف)
- إدارة الفئات والتصنيفات
- إدارة المخزون
- نظام البحث المتقدم
- إدارة الصور المتعددة
- نظام العلامات (Tags)
- إدارة متغيرات المنتج (الحجم، اللون)
- نظام التقييمات والمراجعات

**المسارات الرئيسية**:
```
# إدارة المنتجات
GET    /products              # قائمة المنتجات
GET    /products/:id          # تفاصيل منتج
POST   /products              # إضافة منتج جديد
PUT    /products/:id          # تحديث منتج
DELETE /products/:id          # حذف منتج

# إدارة الفئات
GET    /categories            # قائمة الفئات
POST   /categories            # إضافة فئة جديدة
PUT    /categories/:id        # تحديث فئة
DELETE /categories/:id        # حذف فئة

# البحث والتصفية
GET    /products/search       # البحث في المنتجات
GET    /products/filter       # تصفية المنتجات
GET    /products/trending     # المنتجات الرائجة

# التقييمات
GET    /products/:id/reviews  # تقييمات المنتج
POST   /products/:id/reviews  # إضافة تقييم
PUT    /reviews/:id           # تحديث تقييم
DELETE /reviews/:id           # حذف تقييم
```

### 4. خدمة الطلبات (Order Service) - المنفذ 5004

**الوصف**: تدير جميع عمليات الطلبات والسلة والدفع والشحن.

**الوظائف الرئيسية**:
- إدارة سلة التسوق
- إنشاء ومعالجة الطلبات
- إدارة حالات الطلبات
- معالجة المدفوعات
- إدارة الشحن والتوصيل
- إنشاء الفواتير
- تتبع الطلبات
- إدارة المرتجعات والاستردادات

**المسارات الرئيسية**:
```
# إدارة السلة
GET    /cart                 # عرض السلة
POST   /cart/add             # إضافة منتج للسلة
PUT    /cart/update          # تحديث كمية في السلة
DELETE /cart/remove          # إزالة منتج من السلة
DELETE /cart/clear           # تفريغ السلة

# إدارة الطلبات
GET    /orders               # قائمة الطلبات
GET    /orders/:id           # تفاصيل طلب
POST   /orders               # إنشاء طلب جديد
PUT    /orders/:id/status    # تحديث حالة الطلب
POST   /orders/:id/cancel    # إلغاء طلب
POST   /orders/:id/return    # إرجاع طلب
```

### 5. خدمة البائعين (Vendor Service) - المنفذ 5005

**الوصف**: تدير جميع عمليات البائعين والمتاجر والفروع.

**الوظائف الرئيسية**:
- تسجيل البائعين الجدد
- إدارة ملفات البائعين
- إدارة المتاجر والفروع
- إدارة المعاملات المالية
- طلبات السحب
- نظام التقييمات للبائعين
- إدارة الخدمات المقدمة
- إعدادات المتجر
- رفع شعارات المتاجر

**المسارات الرئيسية**:
```
# إدارة البائعين
GET    /vendors              # قائمة البائعين
GET    /vendors/:id          # تفاصيل بائع
POST   /vendors              # تسجيل بائع جديد
PUT    /vendors/:id          # تحديث بيانات البائع
DELETE /vendors/:id          # حذف بائع

# إدارة المتاجر
GET    /vendors/:id/store    # معلومات المتجر
PUT    /vendors/:id/store    # تحديث معلومات المتجر
POST   /vendors/:id/logo     # رفع شعار المتجر

# المعاملات المالية
GET    /vendors/:id/transactions    # المعاملات المالية
POST   /vendors/:id/withdrawal      # طلب سحب
GET    /vendors/:id/balance         # الرصيد الحالي
```

### 6. خدمة الدعم الفني (Support Service) - المنفذ 5006

**الوصف**: تدير نظام الدعم الفني وتذاكر المساعدة.

**الوظائف الرئيسية**:
- إنشاء تذاكر الدعم
- إدارة الأسئلة الشائعة (FAQ)
- تتبع حالة التذاكر
- نظام الرد على الاستفسارات
- تصنيف المشاكل
- إدارة أولويات التذاكر

### 7. خدمة التحليلات (Analytics Service) - المنفذ 5010

**الوصف**: تدير جميع التحليلات والإحصائيات في النظام.

**الوظائف الرئيسية**:

#### تحليلات الأعمال:
- **تحليلات المبيعات**: إجمالي الإيرادات، الطلبات، متوسط قيمة الطلب
- **تحليلات العملاء**: العملاء الجدد، المتكررين، معدل الاحتفاظ
- **تحليلات المخزون**: المنتجات الأكثر مبيعاً، المخزون المنخفض
- **تحليلات البائعين**: أداء البائعين، الأرباح، التقييمات

#### تحليلات الأداء:
- **أداء التطبيق**: وقت التحميل، استخدام الذاكرة، وحدة المعالجة
- **سجل الأخطاء**: تتبع الأخطاء وتحليلها
- **مشاركة المستخدم**: الجلسات، الصفحات المزارة، الأحداث
- **أداء API**: وقت الاستجابة، معدل النجاح

## قاعدة البيانات

### نظرة عامة
يستخدم النظام قاعدة بيانات MySQL موحدة باسم `supermall` لجميع الخدمات، مما يضمن التكامل والأداء الأمثل.

### الجداول الرئيسية

#### جداول المستخدمين والمصادقة:
- `users`: معلومات المستخدمين الأساسية
- `user_profiles`: الملفات الشخصية المفصلة
- `user_addresses`: عناوين المستخدمين
- `loyalty_points`: نقاط الولاء
- `user_sessions`: جلسات المستخدمين

#### جداول المنتجات:
- `products`: المنتجات الأساسية
- `categories`: فئات المنتجات
- `product_images`: صور المنتجات
- `product_variants`: متغيرات المنتجات
- `product_tags`: علامات المنتجات
- `inventory`: المخزون
- `inventory_history`: سجل تغييرات المخزون

#### جداول الطلبات:
- `orders`: الطلبات الأساسية
- `order_items`: عناصر الطلبات
- `cart`: سلة التسوق
- `cart_items`: عناصر السلة
- `payments`: المدفوعات
- `shipping`: معلومات الشحن
- `order_status_history`: سجل حالات الطلبات

#### جداول البائعين:
- `vendors`: معلومات البائعين
- `vendor_branches`: فروع البائعين
- `vendor_settings`: إعدادات البائعين
- `vendor_transactions`: المعاملات المالية
- `withdrawal_requests`: طلبات السحب
- `vendor_ratings`: تقييمات البائعين
- `vendor_services`: خدمات البائعين

## الأمان والحماية

### آليات الحماية المطبقة:

1. **المصادقة والتفويض**:
   - JWT Tokens للمصادقة
   - نظام أدوار متعدد المستويات
   - انتهاء صلاحية الرموز المميزة
   - تشفير كلمات المرور باستخدام bcrypt

2. **حماية API**:
   - معدل محدود للطلبات (Rate Limiting)
   - التحقق من صحة البيانات المدخلة
   - حماية من هجمات SQL Injection
   - حماية من هجمات XSS
   - إعدادات CORS آمنة

3. **حماية البيانات**:
   - تشفير البيانات الحساسة
   - النسخ الاحتياطية المنتظمة
   - تسجيل العمليات الحساسة
   - إدارة آمنة للملفات المرفوعة

## التشغيل والنشر

### متطلبات النظام:
- **نظام التشغيل**: Linux/Windows/macOS
- **Node.js**: الإصدار 14 أو أحدث
- **MySQL**: الإصدار 8.0 أو أحدث
- **الذاكرة**: 4GB RAM كحد أدنى
- **التخزين**: 20GB مساحة فارغة

### متغيرات البيئة المطلوبة:
```env
# إعدادات عامة
NODE_ENV=production
JWT_SECRET=your_super_secret_jwt_key

# إعدادات قاعدة البيانات
DB_HOST=localhost
DB_PORT=3306
DB_USER=supermall_user
DB_PASSWORD=secure_password
DB_NAME=supermall

# إعدادات البريد الإلكتروني
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your_email@gmail.com
SMTP_PASS=your_app_password

# إعدادات التخزين
UPLOAD_PATH=./uploads
MAX_FILE_SIZE=10485760

# إعدادات الأمان
RATE_LIMIT_WINDOW=900000
RATE_LIMIT_MAX=100
```

### أوامر التشغيل:

#### تشغيل جميع الخدمات:
```bash
# Windows
start-all.bat

# Linux/Mac
./start-all.sh

# أو باستخدام Node.js
node start-all.js
```

#### تشغيل خدمات محددة:
```bash
# تشغيل الخدمات الأساسية فقط
npm run start:core

# تشغيل خدمات المتجر فقط
npm run start:shop

# تشغيل خدمة واحدة
cd auth-service && npm start
```

#### أوامر الصيانة:
```bash
# فحص جودة الكود
npm run lint

# تشغيل الاختبارات
npm test

# تشخيص المشروع
npm run diagnose

# إعادة تثبيت التبعيات
npm run reinstall
```

## استكشاف الأخطاء وإصلاحها

### المشاكل الشائعة وحلولها:

#### 1. مشكلة ECONNRESET:
```bash
# تشغيل سكريبت الإصلاح التلقائي
fix-connection.bat  # Windows
./fix-connection.sh # Linux/Mac
```

#### 2. مشاكل قاعدة البيانات:
```bash
# التحقق من الاتصال
node scripts/test-database.js

# إعادة إنشاء الجداول
node scripts/reset-database.js
```

#### 3. مشاكل الذاكرة:
```bash
# مراقبة استخدام الذاكرة
pm2 monit

# إعادة تشغيل الخدمات
pm2 restart all
```

## الدعم والمساعدة

### الحصول على المساعدة:
1. **الوثائق**: راجع ملفات README في كل خدمة
2. **السجلات**: فحص ملفات السجلات في مجلد logs/
3. **الاختبارات**: تشغيل الاختبارات للتحقق من سلامة النظام
4. **المجتمع**: طرح الأسئلة في منتديات المطورين

### ملفات مفيدة للمرجع:
- `API_GUIDELINES.md`: إرشادات تطوير API
- `ARCHITECTURE.md`: توثيق البنية التقنية
- `SECURITY.md`: إرشادات الأمان
- `DATABASE_GUIDELINES.md`: إرشادات قاعدة البيانات
- `SCALING.md`: استراتيجيات التوسع
- `MONITORING.md`: إرشادات المراقبة

## خاتمة

نظام SuperMall Backend هو حل شامل ومتكامل للتجارة الإلكترونية، مصمم ليكون قابلاً للتوسع والصيانة. يوفر جميع الميزات اللازمة لإدارة متجر إلكتروني حديث مع التركيز على الأداء والأمان وتجربة المستخدم.

للمزيد من المعلومات أو المساعدة، يرجى مراجعة الوثائق المرفقة أو التواصل مع فريق التطوير.